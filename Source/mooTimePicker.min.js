/*
---
description:     
  - mooTimePicker is a sliding timepicker. Allows to select seconds, and the amount of hours/minutes/seconds each step change.

authors:
  - Marcelo Origoni

version:
  - 1.1

license:
  - MIT-style license

requires:
  - core/1.3.0:   '*'
  - more:	'slider'
  
provides:
  - mooTimePicker
...
*/
var mooTimePicker=new Class({Implements:[Options,Events],options:{secondsSliders:false,hoursSteps:"1",minuteSteps:"10",secsSteps:"30",hourLabel:"Hours",minsLabel:"Minutes",secsLabel:"Seconds",labelsPosition:"top",alwaysOn:false,showLabels:false,injectInside:""},initialize:function(v,k){if(MooTools.version>="1.3"){Object.merge(this.options,k)}else{this.options=$merge(this.options,k)}var c,z,a,g,I,e,H,L,n,J,o,t,f,u,x,G,q,l,K,r,y,D,j,d,b,p,E,F,C,A,w,B,M;x=new Element("div",{"class":"timePicker"});D=new Element("div",{"class":"sliders"});if(this.options.showLabels){I=new Element("div",{"class":"labels"});z=new Element("div",{"class":"label",text:this.options.hourLabel});a=new Element("div",{"class":"label",text:this.options.minsLabel});g=new Element("div",{"class":"label",text:this.options.secsLabel});z.inject(I);a.inject(I)}e=new Element("div",{"class":"bar"});t=new Element("div",{"class":"back"});n=new Element("div",{"class":"knob",});H=new Element("div",{"class":"bar"});f=new Element("div",{"class":"back"});J=new Element("div",{"class":"knob",});t.inject(e);n.inject(e);f.inject(H);J.inject(H);e.inject(D);H.inject(D);if(this.options.secondsSliders){L=new Element("div",{"class":"bar"});u=new Element("div",{"class":"back"});o=new Element("div",{"class":"knob",});u.inject(L);o.inject(L);L.inject(D);if(this.options.showLabels){g.inject(I)}}D.inject(x);if(this.options.showLabels){I.inject(x,this.options.labelsPosition)}if(this.options.injectInside){this.options.injectInside=document.id(this.options.injectInside);x.inject(this.options.injectInside)}else{x.inject(v.getParent())}if(!this.options.alwaysOn){v.addEvent("focus",function(){var h=new Fx.Tween(D,{duration:500});h.start("opacity","1")});v.addEvent("blur",function(){var h=new Fx.Tween(D,{duration:500});h.start("opacity","0")})}l=$(v).getProperty("value");if(!l.contains(":")){if(this.options.secondsSliders){l="00:00:00"}else{l="00:00"}}else{if(this.options.secondsSliders){if(l.split(":").length<3){l=l+":00"}}}j=typeof(this.options.hoursSteps);d=new Array();switch(j){case"string":if(this.options.hoursSteps.contains(",")){d=this.options.hoursSteps.split(",");K=Object.getLength(d)}else{this.options.hoursSteps=this.options.hoursSteps.toInt();K=24/this.options.hoursSteps;E=0;F=0;while(E<K){d[E]=F;E++;F=F+this.options.hoursSteps}}break;case"object":Object.each(this.options.hoursSteps,function(s,m){d[m]=s});K=Object.getLength(d);break;case"array":K=this.options.hoursSteps.length();d=this.options.hoursSteps;break;case"number":default:K=24/this.options.hoursSteps;E=0;F=0;while(E<K){d[E]=F;E++;F=F+this.options.hoursSteps}break}if(typeof(d)=="object"){Object.keyOf(d,l.split(":")[0].toInt())?w=Object.keyOf(d,l.split(":")[0].toInt()):w=K}else{d.indexOf(l.split(":")[0].toInt())>-1?w=d.indexOf(l.split(":")[0].toInt()):w=K}j=typeof(this.options.minuteSteps);b=new Array();switch(j){case"string":if(this.options.minuteSteps.contains(",")){b=this.options.minuteSteps.split(",");r=Object.getLength(b)}else{this.options.minuteSteps=this.options.minuteSteps.toInt();r=60/this.options.minuteSteps;E=0;C=0;while(E<r){b[E]=C;E++;C=C+this.options.minuteSteps}}break;case"object":Object.each(this.options.minuteSteps,function(h,s){b[s]=h});r=Object.getLength(b);break;case"array":r=this.options.minuteSteps.length();b=this.options.minuteSteps;break;case"number":default:r=60/this.options.minuteSteps;E=0;C=0;while(E<r){b[E]=C;E++;C=C+this.options.minuteSteps}break}if(typeof(b)=="object"){Object.keyOf(b,l.split(":")[1].toInt())?B=Object.keyOf(b,l.split(":")[1].toInt()):B=r}else{b.indexOf(l.split(":")[1].toInt())>-1?B=b.indexOf(l.split(":")[1].toInt()):B=r}G=new Slider(e,n,{snap:false,steps:K-1,wheel:false,mode:"vertical",onChange:function(h){h=d[K-h-1];h<10?h="0"+h:h=h;var m,i,s=v.getProperty("value");s=s.split(":");m=s[1];if(s.length>2){i=s[2];s=h+":"+m+":"+i}else{s=h+":"+m}v.setProperty("value",s);t.setStyle("height",e.getStyle("height").toInt()-n.getStyle("top").toInt()-n.getStyle("height").toInt())}}).set(w);q=new Slider(H,J,{snap:false,steps:r-1,wheel:false,mode:"vertical",onChange:function(i){i=b[r-i-1];i<10?i="0"+i:i=i;var h,m,s=v.getProperty("value");s=s.split(":");h=s[0];if(s.length>2){m=s[2];s=h+":"+i+":"+m}else{s=h+":"+i}v.setProperty("value",s);f.setStyle("height",H.getStyle("height").toInt()-J.getStyle("top").toInt()-J.getStyle("height").toInt())}}).set(B);if(this.options.secondsSliders){j=typeof(this.options.secsSteps);p=new Array();switch(j){case"string":if(this.options.secsSteps.contains(",")){p=this.options.secsSteps.split(",");y=Object.getLength(p)}else{this.options.secsSteps=this.options.secsSteps.toInt();y=60/this.options.secsSteps;E=0;A=0;while(E<y){p[E]=A;E++;A=A+this.options.secsSteps}}break;case"object":Object.each(this.options.secsSteps,function(m,h){p[h]=m});y=Object.getLength(p);break;case"array":y=this.options.secsSteps.length();p=this.options.secsSteps;break;case"number":default:y=60/this.options.secsSteps;E=0;A=0;while(E<y){p[E]=A;E++;A=A+this.options.secsSteps}break}if(typeof(p)=="object"){Object.keyOf(p,l.split(":")[2].toInt())?M=Object.keyOf(p,l.split(":")[2].toInt()):M=y}else{p.indexOf(l.split(":")[2].toInt())>-1?M=p.indexOf(l.split(":")[2].toInt()):M=y}secs=new Slider(L,o,{snap:false,steps:y-1,wheel:false,mode:"vertical",onChange:function(m){m=p[y-m-1];m<10?m="0"+m:m=m;var h,i,s=v.getProperty("value");s=s.split(":");h=s[0];i=s[1];s=h+":"+i+":"+m;v.setProperty("value",s);u.setStyle("height",L.getStyle("height").toInt()-o.getStyle("top").toInt()-o.getStyle("height").toInt())}}).set(M);u.setStyle("height",L.getStyle("height").toInt()-o.getStyle("top").toInt()-o.getStyle("height").toInt())}this.hours=G;this.mins=q;this.hourBack=t;this.hourSlider=e;this.hourKnob=n;this.minBack=f;this.minSlider=H;this.minKnob=J;t.setStyle("height",e.getStyle("height").toInt()-n.getStyle("top").toInt()-n.getStyle("height").toInt());f.setStyle("height",H.getStyle("height").toInt()-J.getStyle("top").toInt()-J.getStyle("height").toInt());c=new Fx.Tween(D,{duration:50});if(!this.options.alwaysOn){c.start("opacity","0")}},setSlider:function(a){start=$(a).getProperty("value");if(!start.contains(":")){start="00:00"}this.hours.set(23-start.split(":")[0]);this.mins.set(59-start.split(":")[1]);this.hourBack.setStyle("height",this.hourSlider.getStyle("height").toInt()-this.hourKnob.getStyle("top").toInt()-this.hourKnob.getStyle("height").toInt());this.minBack.setStyle("height",this.minSlider.getStyle("height").toInt()-this.minKnob.getStyle("top").toInt()-this.minKnob.getStyle("height").toInt())}});